<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando Promesas</title>
</head>
<body>
    <script>
        'use strict'
        /*
        Forma de uso de Promise()
        new Promise(function(resolve,reject){
            setTimeout(() => resolve(1),1000)
        }).then(functio(result){
            alert(result)
            return result * 2
        }).then(function(result){
            alert(result)
            return result
        })
        */
       /*
        alert("Uso de Promise")
       // Ejemplo (not chaining)
       let promise = new Promise(function(resolve,reject){
           setTimeout(() => resolve(1),1000)
       })
       promise.then(function(result){
           alert(result)
           return result * 2
       })
       promise.then(function(result){
           alert(result)
           return result * 2
       })
       promise.then(function(result){
           alert(result)
           return result * 2
       })
       */
    </script>
    <script>
        /*
        'use strict'
        alert("Retornando Promesa")
        new Promise(function(resolve,reject){
            setTimeout(() => resolve(1),1000)
        }).then(function(result){
            alert(result)
            return new Promise((resolve,reject) => {
                setTimeout(() => resolve(result * 2),1000)
            })
        }).then(function(result){
            alert(result)
            return new Promise((resolve,reject) => {
                setTimeout(() => resolve(result * 2),1000 )
            })

        }).then(function(result){
            alert(result)
        })
        /*
        Ejemplo de carga de un escript:
        loadScript("/article/promise-chaining/one.js")
        .then(function(script){
            return loadScript("/article/promise-chaining/two.js")
        }).then(function(script){
            one(),
            two()
            three()
        })
        */
       
    </script>
    <script>
        /*
        'use strict'
        alert("Ejemplo de uso personalizado ")
        //Ejemplo de un thenable object
       class Thenable {
           constructor(num){
               this.num = num
           }
           then(resolve,reject){
               alert(resolve)
               setTimeout(() => resolve(this.num * 2),2000)
           }
       }
       new Promise(resolve => resolve(1)).then(result => {
           return new Thenable(result)
       })
       */
    </script>
    <script>
        'use strict'
        alert("Ejemplo de fetch")
        let promise = fetch(url)
        /*
        Ejemplo 1

        fech('/article/promise-chaining/user.json')
        .then(function(response){
            return response.text()
        }).then(function(response){
            alert(text); // {"name":"iliakan",isAdmin:true}
        })

        Ejemplo 2
        // Make a request for user.json
        fetch('/article/promise-chaining/user.json')
        // Load it as json
        .then(response => response.json())
        // Make a request to GitHub
        .then(user => fetch(`https://api.github.com/users/${user.name}`))
        // Load the response as json
        .then(response => response.json())
        // Show the avatar image (githubUser.avatar_url) for 3 seconds (maybe animate it)
        .then(githubUser => {
        let img = document.createElement('img');
        img.src = githubUser.avatar_url;
        img.className = "promise-avatar-example";
        document.body.append(img);
        setTimeout(() => img.remove(), 3000); // (*)
        });

        Ejemplo 3 resoviendo despues que se carga el avatar 

        fetch('/article/promise-chaining/user.json')
        .then(response => response.json())
        .then(user => fetch(`https://api.github.com/users/${user.name}`))
        .then(response => response.json())
        .then(githubUser => new Promise(function(resolve, reject) { ***
        let img = document.createElement('img');
        img.src = githubUser.avatar_url;
        img.className = "promise-avatar-example";
        document.body.append(img);
        setTimeout(() => {
        img.remove();
        resolve(githubUser); ****
        }, 3000);
        }))
        // triggers after 3 seconds
        .then(githubUser => alert(`Finished showing ${githubUser.name}`));

        Nota: Como regla una accion asincronica deberia siempre retornar una promesa
        */
    </script>
    <script>
        /*
        'use strict'
        alert('Ejemplo separando las funciones')
        function loadJson(url){
            return fetch(url).then(response => response.json())
        }
        function loadGithubUser(name){
            return fetch(`https://api.github.com/users/${name}`)
            .then(response => response.json())
        }
        function showAvatar(githubUser){
            return new Promise(function(resolve,reject){
                let img = document.createElement('img')
                img.src = githubUser.avatar_url
                img.className = 'promise-avatar-example'
                document.body.append(img)

                setTimeout(() => {
                    imag.remove()
                    resolve(githubUsser)
                },3000)
            })
        }
        loadJson('/article7promise-chaining/user.json')
        .then(user => loadGithubUser(user.name))
        .then(githubUser => alert(`Finished showing ${githubUser}`))
        */
    </script>
    <script>
        'use strict'
        alert('Ejercicio 1')
        /*
        promise.then(f1).catch(f2)
        vs
        promise.then(f1,f2)
        Nota: Son diferentes porque en el primer caso si ocurre un error en f1 es capturado por .catch().
              en el segundo caso no ocurre esto porque no existe un catch(), el error es pasado al siguiente
              .then()
        */
        
    </script>
    
</body>
</html>